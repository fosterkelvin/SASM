# Individual Document Review System - Complete Guide

## üéØ Overview

The HR Requirements Management system now supports **granular document-level reviews**. HR can approve or reject **individual documents** within a submission, allowing applicants to fix only problematic documents instead of resubmitting everything.

---

## ‚ú® New Features

### 1. **Document-Level Status Tracking**

Each document now has its own review status:

- **‚è∞ Pending** (Amber) - Not yet reviewed
- **‚úÖ Approved** (Green) - Approved by HR
- **‚ùå Rejected** (Red) - Needs resubmission with specific reason

### 2. **Individual Approve/Reject Buttons**

In the View Details modal, each document has:

- **Approve** button (Green) - Approve this specific document
- **Reject** button (Red) - Reject with specific reason
- Status badge showing current review state

### 3. **Rejection Reasons**

When rejecting a document, HR can:

- Enter a specific reason (required)
- Reason is displayed under the document
- Applicant receives detailed notification

### 4. **Automatic Submission Status Updates**

- If **all documents approved** ‚Üí Submission status: **Approved** ‚úÖ
- If **any document rejected** ‚Üí Submission status: **Pending** ‚è∞
- Smart logic prevents submission approval until all docs are approved

### 5. **Targeted Notifications**

Students receive specific notifications:

- "Document Approved: Letter of Application" ‚úÖ
- "Document Rejected: Resume/CV - Reason: Missing signature" ‚ùå
- Clear indication of which document needs attention

---

## üóÑÔ∏è Database Schema Updates

### RequirementsFile Interface (Updated)

```typescript
interface RequirementsFile {
  label: string;
  url: string;
  publicId?: string;
  originalName?: string;
  mimetype?: string;
  size?: number;

  // NEW: Document-level review fields
  documentStatus?: "pending" | "approved" | "rejected";
  rejectionReason?: string;
  reviewedByHR?: ObjectId;
  reviewedAt?: Date;
}
```

### Default Values

- New documents: `documentStatus = "pending"`
- All existing documents: Will default to "pending" until reviewed

---

## üîÑ Workflows

### Scenario 1: Approve All Documents One by One

```
1. HR opens submission
2. Reviews first document ‚Üí Clicks "Approve" ‚úÖ
   - Document status: Approved
   - Notification sent to student
3. Reviews second document ‚Üí Clicks "Approve" ‚úÖ
4. Reviews all documents...
5. When ALL approved:
   - Submission status automatically changes to "Approved" ‚úÖ
```

### Scenario 2: Reject Specific Document

```
1. HR opens submission
2. Reviews "Resume/CV"
3. Finds issue (e.g., missing signature)
4. Clicks "Reject" on that document ‚ùå
5. Enters reason: "Missing signature on page 2"
6. Document status: Rejected ‚ùå
7. Student receives notification:
   "Document Rejected: Resume/CV"
   "Reason: Missing signature on page 2"
8. Other documents remain unaffected
9. Submission status: Pending (has rejected document)
```

### Scenario 3: Mixed Review Status

```
Documents Status:
- Letter of Application: ‚úÖ Approved
- Resume/CV: ‚ùå Rejected (Missing signature)
- Grades: ‚úÖ Approved
- Birth Certificate: ‚è∞ Pending
- Good Moral: ‚úÖ Approved

Result:
- Submission Status: ‚è∞ Pending
- Student can see which documents need action
- Student only resubmits "Resume/CV"
```

---

## üé® UI Components

### Document Card with Status Badge

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìÑ [PDF]                                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ Letter of Application          [‚úÖ Approved]               ‚îÇ
‚îÇ application-letter.pdf                                      ‚îÇ
‚îÇ application/pdf ‚Ä¢ 245 KB                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [üîó Open] [‚¨áÔ∏è Download] [‚úÖ Approve] [‚ùå Reject]           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üìÑ [PDF]                                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ Resume/Curriculum Vitae        [‚ùå Rejected]               ‚îÇ
‚îÇ resume.pdf                                                  ‚îÇ
‚îÇ application/pdf ‚Ä¢ 512 KB                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ ‚ö†Ô∏è Rejection Reason:                                        ‚îÇ
‚îÇ Missing signature on page 2                                 ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [üîó Open] [‚¨áÔ∏è Download] [‚úÖ Approve]                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üñºÔ∏è [JPG]                                                    ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ Photocopy of Grades            [‚è∞ Pending]                 ‚îÇ
‚îÇ grades.jpg                                                  ‚îÇ
‚îÇ image/jpeg ‚Ä¢ 1.2 MB                                         ‚îÇ
‚îÇ                                                             ‚îÇ
‚îÇ [üîó Open] [‚¨áÔ∏è Download] [‚úÖ Approve] [‚ùå Reject]           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Rejection Reason Display

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚ö†Ô∏è Rejection Reason:                            ‚îÇ
‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  ‚îÇ
‚îÇ Missing signature on page 2. Please sign and   ‚îÇ
‚îÇ resubmit with a clear copy.                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß API Endpoints

### Review Individual Document

```http
PATCH /requirements/review-document
Authorization: Required (HR role)
Content-Type: application/json

Request Body:
{
  "submissionId": "67890abcdef...",
  "documentIndex": 1,  // Index of document in items array
  "documentStatus": "rejected",  // or "approved" or "pending"
  "rejectionReason": "Missing signature on page 2"  // Required if rejected
}

Response:
{
  "message": "Document rejected",
  "submission": {
    "_id": "...",
    "items": [
      {
        "label": "Resume/CV",
        "documentStatus": "rejected",
        "rejectionReason": "Missing signature on page 2",
        "reviewedByHR": "...",
        "reviewedAt": "2025-10-24T..."
      }
    ]
  }
}
```

---

## üîî Notification Examples

### Document Approved

```javascript
{
  title: "Document Approved: Letter of Application",
  message: "Your document 'Letter of Application' has been approved by HR.",
  type: "success"
}
```

### Document Rejected

```javascript
{
  title: "Document Rejected: Resume/Curriculum Vitae",
  message: "Your document 'Resume/Curriculum Vitae' needs attention. Reason: Missing signature on page 2",
  type: "error"
}
```

### All Documents Approved (Auto)

```javascript
{
  title: "Requirements Approved",
  message: "Congratulations! All your requirements have been approved by HR.",
  type: "success"
}
```

---

## üéØ Button Logic

### Pending Document ‚è∞

Shows:

- **Approve** (Green) - Approve this document
- **Reject** (Red) - Reject with reason

### Approved Document ‚úÖ

Shows:

- **Reject** (Red) - Can re-reject if needed
- _(No Approve button - already approved)_

### Rejected Document ‚ùå

Shows:

- **Approve** (Green) - Give second chance
- _(No Reject button - already rejected)_
- **Rejection reason displayed below**

---

## üìä Smart Submission Status Logic

### Auto-Approval

```typescript
// When reviewing a document:
const allApproved = submission.items.every(
  (item) => item.documentStatus === "approved"
);

if (allApproved && submission.reviewStatus !== "approved") {
  submission.reviewStatus = "approved";
  // Send success notification to student
}
```

### Auto-Pending

```typescript
// When rejecting a document:
const anyRejected = submission.items.some(
  (item) => item.documentStatus === "rejected"
);

if (anyRejected && submission.reviewStatus === "approved") {
  submission.reviewStatus = "pending";
  // Reverts to pending if any document is rejected
}
```

---

## üé¨ Complete User Flow

### HR Reviewing Documents

```
1. Click "View" on a submission
2. Modal opens showing all documents
3. Review first document:
   a. Click "Open" to view file
   b. Decide: Approve or Reject

4. If Approve:
   - Click "Approve" button
   - Document badge turns green ‚úÖ
   - Button disappears
   - Student notified

5. If Reject:
   - Click "Reject" button
   - Prompt appears: "Why are you rejecting...?"
   - Enter reason: "Missing signature"
   - Document badge turns red ‚ùå
   - Rejection reason displayed below document
   - Student notified with reason

6. Repeat for all documents
7. When all approved:
   - Submission automatically becomes "Approved"
   - Student receives final approval notification
```

### Student Receiving Notifications

```
1. Receives notification: "Document Rejected: Resume/CV"
2. Clicks notification ‚Üí Opens requirements page
3. Sees document with rejection reason
4. Fixes issue (adds signature)
5. Resubmits only that document
6. HR reviews again
7. HR approves
8. Student receives: "Document Approved: Resume/CV"
9. When all docs approved ‚Üí "Requirements Approved"
```

---

## üí° Benefits

### For HR

‚úÖ **Granular Control** - Review each document individually
‚úÖ **Specific Feedback** - Provide exact reasons for rejection
‚úÖ **Flexible Workflow** - Can review documents in any order
‚úÖ **Clear Status** - Visual indicators for each document
‚úÖ **Efficient Review** - Focus on problematic documents only

### For Students

‚úÖ **Targeted Action** - Know exactly what needs fixing
‚úÖ **Partial Progress** - Approved documents stay approved
‚úÖ **Clear Reasons** - Understand why document was rejected
‚úÖ **Faster Fixes** - Only resubmit problematic documents
‚úÖ **Better Communication** - Specific notifications per document

---

## üîÑ Comparison

### Old System (Submission-Level Only)

```
‚ùå All or nothing - reject entire submission
‚ùå Student must resubmit ALL documents
‚ùå Generic rejection reasons
‚ùå Inefficient for small issues
‚ùå Approved documents need re-review
```

### New System (Document-Level) ‚úÖ

```
‚úÖ Granular control - review each document
‚úÖ Student resubmits only problematic docs
‚úÖ Specific reasons per document
‚úÖ Efficient targeted reviews
‚úÖ Approved documents stay approved
```

---

## üìù Example Scenarios

### Scenario A: Missing Signature

```
Problem: Resume missing signature on page 2

Old Way:
1. Reject entire submission
2. Reason: "Issues with resume"
3. Student resubmits ALL 6 documents
4. HR re-reviews ALL 6 documents

New Way:
1. Approve 5 documents
2. Reject only "Resume" with reason: "Missing signature on page 2"
3. Student fixes and resubmits ONLY resume
4. HR reviews ONLY that document
```

### Scenario B: Poor Quality Photo

```
Problem: Birth certificate photo is blurry

New Way:
1. HR reviews "Birth Certificate"
2. Clicks "Reject"
3. Enters: "Image is too blurry. Please take a clearer photo in good lighting"
4. Student receives specific notification
5. Student retakes photo and resubmits
6. HR approves on second review
7. Other 5 documents remain approved
```

---

## üß™ Testing Checklist

### HR Testing

- [ ] Open submission details modal
- [ ] See status badge on each document
- [ ] Click "Approve" on a pending document
- [ ] Verify status changes to "Approved" ‚úÖ
- [ ] Verify button changes (no more approve button)
- [ ] Click "Reject" on a pending document
- [ ] Enter rejection reason in prompt
- [ ] Verify status changes to "Rejected" ‚ùå
- [ ] Verify rejection reason displays under document
- [ ] Verify student receives notification
- [ ] Approve all documents one by one
- [ ] Verify submission status becomes "Approved"
- [ ] Reject one previously approved document
- [ ] Verify submission status reverts to "Pending"

### Student Testing

- [ ] Receive document rejection notification
- [ ] See which document was rejected
- [ ] Read rejection reason
- [ ] Fix the issue
- [ ] Resubmit only that document
- [ ] Receive document approval notification
- [ ] When all approved, receive submission approval

---

## üöÄ Future Enhancements

### Possible Additions

1. **Batch Document Review**

   - Select multiple documents
   - Approve/reject in bulk

2. **Document Comments**

   - Add notes to approved documents
   - "Approved with minor concerns"

3. **Version History**

   - Track document resubmissions
   - Show previous versions
   - Compare changes

4. **Review Templates**

   - Pre-defined rejection reasons
   - Quick select from dropdown
   - Common issues list

5. **Review Analytics**
   - Most rejected document types
   - Average review time per document
   - Common rejection reasons

---

## üìä Statistics Impact

The statistics remain at **submission level**:

- **Total**: All submissions
- **Approved**: ALL documents approved
- **Pending**: Any document not approved

Individual document status **does not** affect statistics directly, but determines overall submission status.

---

## üîí Security

### Authorization

- Only HR can review documents
- User role validated from database
- Cannot review own submissions

### Audit Trail

- Records who reviewed each document
- Records when review occurred
- Stores rejection reasons permanently

---

## üìÅ Files Modified

### Backend

1. **`backend/src/models/requirementsSubmission.model.ts`**

   - Added document-level review fields
   - Added `documentStatus`, `rejectionReason`, `reviewedByHR`, `reviewedAt`

2. **`backend/src/controllers/requirements.controller.ts`**

   - Added `reviewDocument` function
   - Smart submission status logic
   - Document-specific notifications

3. **`backend/src/routes/requirements.route.ts`**
   - Added `PATCH /review-document` route

### Frontend

1. **`ViewSubmissionModal.tsx`**

   - Added status badges per document
   - Added approve/reject buttons per document
   - Added rejection reason display
   - Added document review handlers
   - Auto-refresh after review

2. **`RequirementsManagement.tsx`**
   - Passed `onUpdate` callback to modal

---

**Last Updated**: October 24, 2025
**Version**: 3.0 with Document-Level Review
**Status**: ‚úÖ Production Ready
